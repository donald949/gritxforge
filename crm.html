<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#2c3e50">
    <title>Grit x Forge CRM - Recruiting Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2c3e50;
            min-height: 100vh;
            padding: 0;
            line-height: 1.6;
            margin: 0;
        }

        /* Sidebar Styles - Match existing design */
        .sidebar {
            width: 60px;
            background: #2c3e50;
            transition: width 0.3s ease;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow: hidden;
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar.expanded {
            width: 250px;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 70px;
        }

        .sidebar-logo {
            color: #a10e02;
            font-weight: 700;
            font-size: 1.5em;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s ease;
            margin-left: 0;
        }

        .sidebar.expanded .sidebar-logo {
            opacity: 1;
            margin-left: 0;
        }

        /* When sidebar is collapsed, hide logo to avoid hamburger menu interference */
        .sidebar:not(.expanded) .sidebar-logo {
            opacity: 0;
            visibility: hidden;
        }

        .sidebar-toggle {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Hamburger menu icon */
        .hamburger {
            width: 20px;
            height: 20px;
            position: relative;
            cursor: pointer;
        }

        .hamburger span {
            display: block;
            position: absolute;
            height: 2px;
            width: 100%;
            background: white;
            border-radius: 1px;
            opacity: 1;
            left: 0;
            transform: rotate(0deg);
            transition: .25s ease-in-out;
        }

        .hamburger span:nth-child(1) {
            top: 3px;
        }

        .hamburger span:nth-child(2) {
            top: 9px;
        }

        .hamburger span:nth-child(3) {
            top: 15px;
        }

        /* Hamburger animation when expanded */
        .sidebar.expanded .hamburger span:nth-child(1) {
            top: 9px;
            transform: rotate(135deg);
        }

        .sidebar.expanded .hamburger span:nth-child(2) {
            opacity: 0;
            left: -20px;
        }

        .sidebar.expanded .hamburger span:nth-child(3) {
            top: 9px;
            transform: rotate(-135deg);
        }

        /* Mobile Hamburger Menu Button */
        .mobile-hamburger {
            display: flex;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
            background: #2c3e50;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            width: 40px;
            height: 40px;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .mobile-hamburger .hamburger {
            width: 18px;
            height: 18px;
            position: relative;
        }

        /* Hamburger stays in top-left corner at all screen sizes */

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-left-color: #a10e02;
        }

        .nav-item.active {
            background: rgba(161, 14, 2, 0.2);
            color: white;
            border-left-color: #a10e02;
        }
        
        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logout-btn {
            background: none;
            border: none;
            width: 100%;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(161, 14, 2, 0.2);
            color: #ff6b6b;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .nav-item span {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar.expanded .nav-item span {
            opacity: 1;
        }

        .nav-item svg {
            min-width: 20px;
            width: 20px;
            height: 20px;
            margin-right: 15px;
        }

        .nav-item span {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar.expanded .nav-item span {
            opacity: 1;
        }

        .container {
            margin-left: 60px;
            padding: 40px;
            background: #ffffff;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        .sidebar.expanded ~ .container {
            margin-left: 250px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 2.2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .brand-highlight {
            color: #a10e02;
        }

        .header-left p {
            color: #6c757d;
            font-size: 0.95em;
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .user-info {
            background: #f8f9fa;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #495057;
            border: 1px solid #e8ecef;
        }

        .user-info strong {
            color: #a10e02;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 44px; /* Touch-friendly height */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a10e02 0%, #7a0a01 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #7a0a01 0%, #5a0701 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(161, 14, 2, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .section {
            margin-bottom: 40px;
        }

        h2 {
            color: #2c3e50;
            font-size: 1.6em;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #a10e02;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e8ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .number {
            font-size: 2em;
            font-weight: 700;
            color: #a10e02;
        }

        /* Reminder Alerts Styling */
        .reminder-card {
            background: #fff;
            border-left: 5px solid #ffc107;
            padding: 15px 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reminder-card.overdue {
            border-left-color: #dc3545;
            background: #fdf2f2;
        }

        .reminder-card.due-today {
            border-left-color: #fd7e14;
            background: #fef8f5;
        }

        .reminder-card.upcoming {
            border-left-color: #17a2b8;
            background: #f0f9ff;
        }

        .reminder-info {
            flex-grow: 1;
        }

        .reminder-prospect {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .reminder-details {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .reminder-purpose {
            color: #2c3e50;
            font-size: 0.9em;
            margin-top: 6px;
            padding: 6px 10px;
            background: linear-gradient(135deg, #e8f4f8 0%, #d1ecf1 100%);
            border-radius: 6px;
            border-left: 3px solid #17a2b8;
            font-weight: 600;
            display: inline-block;
        }
        
        .reminder-notes {
            color: #495057;
            font-size: 0.85em;
            margin-top: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border-left: 3px solid #a10e02;
            font-style: italic;
            line-height: 1.4;
        }

        .reminder-actions {
            display: flex;
            gap: 10px;
        }

        .btn-reminder {
            padding: 6px 12px;
            font-size: 0.8em;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-snooze {
            background: #6c757d;
            color: white;
        }

        .btn-snooze:hover {
            background: #5a6268;
        }

        .btn-complete {
            background: #28a745;
            color: white;
        }

        .btn-complete:hover {
            background: #218838;
        }

        .btn-edit-reminder {
            background: #17a2b8;
            color: white;
        }

        .btn-edit-reminder:hover {
            background: #138496;
        }

        .no-reminders {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-group label {
            font-weight: 600;
            font-size: 14px;
            color: #495057;
        }

        select, input {
            padding: 14px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px; /* Prevents zoom on iOS */
            background: #ffffff;
            color: #495057;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            width: 100%;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #a10e02;
            box-shadow: 0 0 0 3px rgba(161, 14, 2, 0.1);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e8ecef;
            background: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px; /* Ensure minimum table width */
        }

        thead {
            background: #f8f9fa;
        }
        
        /* Column width specifications */
        th:nth-child(1) { width: 50px; min-width: 50px; } /* Checkbox */
        th:nth-child(2) { width: 180px; min-width: 180px; } /* Name */
        th:nth-child(3) { width: 200px; min-width: 200px; } /* Contact */
        th:nth-child(4) { width: 150px; min-width: 150px; } /* Status */
        th:nth-child(5) { width: 150px; min-width: 150px; } /* Recruiter */
        th:nth-child(6) { width: 140px; min-width: 140px; } /* Follow-up */
        th:nth-child(7) { width: 100px; min-width: 100px; } /* Source */
        th:nth-child(8) { width: 140px; min-width: 140px; } /* Actions */
        
        /* Prevent wrapping in status column */
        td:nth-child(4) { 
            white-space: nowrap; 
            text-align: center;
        }

        th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e8ecef;
            font-size: 14px;
        }

        td {
            padding: 14px 16px;
            border-bottom: 1px solid #e8ecef;
            font-size: 14px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            text-align: center;
            min-width: fit-content;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }
        
        /* Enhanced status badge colors */
        .status-lead { 
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); 
            color: #856404; 
            border: 1px solid rgba(133, 100, 4, 0.2);
        }
        
        .status-contacted { 
            background: linear-gradient(135deg, #cfe2ff 0%, #a6c8ff 100%); 
            color: #084298; 
            border: 1px solid rgba(8, 66, 152, 0.2);
        }
        
        .status-interview_scheduled { 
            background: linear-gradient(135deg, #d1ecf1 0%, #a8dadc 100%); 
            color: #0c5460; 
            border: 1px solid rgba(12, 84, 96, 0.2);
        }
        
        .status-offer_made { 
            background: linear-gradient(135deg, #d4edda 0%, #b8e6b8 100%); 
            color: #155724; 
            border: 1px solid rgba(21, 87, 36, 0.2);
        }
        
        .status-hired { 
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%); 
            color: #004d40; 
            border: 1px solid rgba(0, 77, 64, 0.2);
        }
        
        .status-rejected { 
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); 
            color: #721c24; 
            border: 1px solid rgba(114, 28, 36, 0.2);
        }
        
        .status-not_interested { 
            background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%); 
            color: #495057; 
            border: 1px solid rgba(73, 80, 87, 0.2);
        }

        /* Keeping interview_completed status for existing data */
        .status-interview_completed { 
            background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%); 
            color: #41464b; 
            border: 1px solid rgba(65, 70, 75, 0.2);
        }

        .priority-high { color: #dc3545; font-weight: bold; }
        .priority-medium { color: #fd7e14; }
        .priority-low { color: #28a745; }
        
        /* Prospect name link styling */
        .prospect-name-link {
            color: #2c3e50;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid transparent;
            display: inline-block;
            padding: 2px 0;
        }
        
        .prospect-name-link:hover {
            color: #a10e02 !important;
            border-bottom-color: #a10e02;
            transform: translateY(-1px);
        }

        .alert {
            padding: 14px 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 500;
            display: none;
        }

        .alert.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #2c3e50;
            font-size: 1.4em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 14px;
            color: #495057;
        }

        textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px; /* Prevents zoom on iOS */
            background: #ffffff;
            color: #495057;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        textarea:focus {
            outline: none;
            border-color: #a10e02;
            box-shadow: 0 0 0 3px rgba(161, 14, 2, 0.1);
        }

        .modal-footer {
            margin-top: 25px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state img {
            width: 100px;
            opacity: 0.5;
            margin-bottom: 15px;
        }

        /* Advanced Filters Styles */
        .advanced-filters {
            background: rgba(161, 14, 2, 0.05);
            border: 1px solid rgba(161, 14, 2, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        /* Bulk Actions Bar Styles */
        .bulk-actions-bar {
            background: linear-gradient(90deg, #17a2b8, #138496);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .bulk-actions-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bulk-actions-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .bulk-actions-buttons select {
            background: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 14px;
        }

        /* Prospect row selection styles */
        .prospect-row.selected {
            background-color: rgba(161, 14, 2, 0.1);
        }

        .prospect-checkbox {
            transform: scale(1.2);
            cursor: pointer;
        }

        /* Enhanced filter styles */
        .filter-group input[type="date"] {
            width: 140px;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        /* Export/Import styles */
        .import-export-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .import-export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .file-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #file-input {
            display: none;
        }

        .file-input-label {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .file-input-label:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
                z-index: 1000;
            }

            .sidebar.expanded {
                transform: translateX(0);
            }

            .container {
                margin-left: 0;
                padding: 25px 20px;
                padding-top: 80px;
            }

            .sidebar.expanded ~ .container {
                margin-left: 0;
            }

            /* Overlay when sidebar is open on mobile */
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }

            .sidebar-overlay.active {
                display: block;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
            
            /* Enhanced mobile styling for app-like experience */
            body {
                background: #f8f9fa; /* Lighter, more app-like background on mobile */
            }
            
            .container {
                padding: 16px 12px;
                padding-top: 80px;
            }
            
            .header {
                margin-bottom: 16px;
            }
            
            .header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }
            
            .stats-grid {
                gap: 12px;
                margin-bottom: 20px;
            }
            
            .stat-card {
                padding: 16px 12px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            .reminder-alerts {
                margin-bottom: 20px;
            }
            
            .table-container {
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            
            .filters {
                background: white;
                padding: 16px;
                border-radius: 12px;
                margin-bottom: 16px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            /* Mobile button improvements */
            .btn {
                min-height: 48px; /* Larger touch target for mobile */
                font-size: 14px;
                padding: 14px 20px;
            }
            
            .btn-sm {
                min-height: 40px;
                padding: 10px 16px;
                font-size: 12px;
            }
            
            /* Mobile modal improvements */
            .modal-content {
                margin: 10px;
                max-height: calc(100vh - 40px);
                overflow-y: auto;
                border-radius: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .modal-header {
                padding: 20px 24px 16px 24px;
                border-bottom: 1px solid #eee;
            }
            
            .modal-body {
                padding: 20px 24px;
            }
            
            .modal-footer {
                padding: 16px 24px 24px 24px;
                gap: 12px;
            }
            
            /* Mobile reminder button improvements */
            .reminder-actions {
                gap: 6px;
            }
            
            .btn-reminder {
                padding: 8px;
                min-width: 40px;
                min-height: 40px;
                font-size: 16px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Hide button text on mobile, show only icons */
            .btn-reminder .btn-text {
                display: none;
            }
            
            /* Mobile reminder card improvements */
            .reminder-card {
                padding: 12px 16px;
                margin-bottom: 12px;
            }
            
            .reminder-prospect {
                font-size: 1.1em;
                margin-bottom: 4px;
            }
            
            .reminder-details {
                font-size: 0.85em;
                margin-bottom: 6px;
            }
            
            .reminder-purpose {
                font-size: 0.8em;
                padding: 4px 8px;
                margin-top: 4px;
            }
            
            .reminder-notes {
                font-size: 0.8em;
                padding: 6px 10px;
                margin-top: 6px;
            }
            
            /* Mobile header button improvements */
            .header-right {
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
            }
            
            .header-right .btn {
                font-size: 14px;
                padding: 10px 16px;
                min-height: 40px;
                text-transform: none;
                letter-spacing: 0;
            }
        }
        
        /* Desktop enhancements */
        @media (min-width: 769px) {
            .container {
                padding: 24px 30px;
                margin-left: 60px;
                max-width: calc(100% - 60px);
            }
            
            .sidebar.expanded ~ .container {
                margin-left: 250px;
                max-width: calc(100% - 250px);
            }
            
            .stat-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                transition: all 0.3s ease;
            }
            
            .table-container {
                max-height: calc(100vh - 400px);
                overflow-y: auto;
            }
            
            /* Desktop reminder button styling */
            .btn-reminder {
                padding: 6px 12px;
                min-width: auto;
                min-height: auto;
                font-size: 0.8em;
                gap: 4px;
            }
            
            .btn-reminder .btn-text {
                display: inline;
            }
        }
        
        /* Large desktop optimization */
        @media (min-width: 1200px) {
            .container {
                max-width: 1400px;
                margin-left: auto;
                margin-right: auto;
                padding: 32px 40px;
            }
            
            .sidebar.expanded ~ .container {
                max-width: calc(1400px - 190px);
                margin-left: 250px;
                margin-right: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Hamburger Menu -->
    <button class="mobile-hamburger" onclick="toggleSidebar()">
        <div class="hamburger" id="mobile-hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </button>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 16 16">
                    <path d="M0 1.5A1.5 1.5 0 0 1 1.5 0h2A1.5 1.5 0 0 1 5 1.5v2A1.5 1.5 0 0 1 3.5 5h-2A1.5 1.5 0 0 1 0 3.5v-2zM1.5 1a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-2zM0 8a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8zm1 3v2a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2H1zm14-1V8a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v2h14zM2 8.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                </svg>
                <span>Calculator</span>
            </a>
            <a href="my-training.html" class="nav-item" id="nav-my-training" style="display: none;">
                <svg fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8.5 2.687c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.81 8.985.936 8 1.783z"/>
                </svg>
                <span>My Training</span>
            </a>
            <div class="nav-item active">
                <svg fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                    <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                </svg>
                <span>CRM Dashboard</span>
            </div>
            <a href="rep-profile.html" class="nav-item" id="nav-training" style="display: none;">
                <svg fill="currentColor" viewBox="0 0 16 16">
                    <path d="M15.854.146a.5.5 0 0 1 .11.54L13.026 8.99A8.5 8.5 0 1 1 8.985 2.97l-8.302 2.938a.5.5 0 0 1 .54-.11z"/>
                    <circle cx="8.5" cy="7.5" r="2"/>
                    <path d="M12.5 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm-.646-4.854.646.647.646-.647a.5.5 0 0 1 .708.708l-.647.646.647.646a.5.5 0 0 1-.708.708L12.5 12.207l-.646.647a.5.5 0 0 1-.708-.708l.647-.646-.647-.646a.5.5 0 0 1 .708-.708Z"/>
                </svg>
                <span>Training Tracker</span>
            </a>
            <a href="admin.html" class="nav-item" id="nav-admin" style="display: none;">
                <svg fill="currentColor" viewBox="0 0 16 16">
                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                </svg>
                <span>Admin Portal</span>
            </a>
        </nav>
        <!-- Logout button at bottom of sidebar -->
        <div class="sidebar-footer">
            <button onclick="logout()" class="nav-item logout-btn">
                <svg fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                    <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708L12.707 4.5a.5.5 0 1 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.294 2.146a.5.5 0 0 0 .708.708l3.147-2.856z"/>
                </svg>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1><span class="brand-highlight">Grit x Forge</span> CRM Dashboard</h1>
                <p>Recruiting pipeline and prospect management</p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    Logged in as: <strong id="current-user-email"></strong> (<span id="current-user-role"></span>)
                </div>
                <button onclick="openAddProspectModal()" class="btn btn-primary">Add New Prospect</button>
            </div>
        </div>

        <div id="alert-message" class="alert"></div>

        <!-- Follow-up Reminders -->
        <div class="section" id="reminders-section">
            <h2>ðŸ“… Follow-up Reminders</h2>
            <div id="reminder-alerts">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="section">
            <h2>Pipeline Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Prospects</h3>
                    <div class="number" id="total-prospects">0</div>
                </div>
                <div class="stat-card">
                    <h3>Active Leads</h3>
                    <div class="number" id="active-leads">0</div>
                </div>
                <div class="stat-card">
                    <h3>Interviews Scheduled</h3>
                    <div class="number" id="interviews-scheduled">0</div>
                </div>
                <div class="stat-card">
                    <h3>Hired This Month</h3>
                    <div class="number" id="hired-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>Overdue Follow-ups</h3>
                    <div class="number priority-high" id="overdue-followups">0</div>
                </div>
            </div>
        </div>

        <!-- Import/Export Section -->
        <div class="section">
            <div class="import-export-section">
                <h3 style="margin-bottom: 15px; color: #2c3e50;">Data Management</h3>
                <div class="import-export-buttons">
                    <button onclick="exportProspects()" class="btn btn-success">Export to CSV</button>
                    <div class="file-input-group">
                        <label for="file-input" class="file-input-label">Import CSV</label>
                        <input type="file" id="file-input" accept=".csv" onchange="importProspects(event)">
                        <span id="file-name" style="font-size: 14px; color: #6c757d;"></span>
                    </div>
                    <button onclick="showImportTemplate()" class="btn btn-outline-secondary">Download Template</button>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="section">
            <h2>Prospect Pipeline</h2>
            <div class="filters">
                <div class="filter-group">
                    <label for="status-filter">Status:</label>
                    <select id="status-filter" onchange="filterProspects()">
                        <option value="">All Statuses</option>
                        <option value="lead">Lead</option>
                        <option value="contacted">Contacted</option>
                        <option value="interview_scheduled">Interview Scheduled</option>
                        <option value="interview_completed">Interview Completed</option>
                        <option value="offer_made">Offer Made</option>
                        <option value="hired">Hired</option>
                        <option value="rejected">Rejected</option>
                        <option value="not_interested">Not Interested</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="recruiter-filter">Recruiter:</label>
                    <select id="recruiter-filter" onchange="filterProspects()">
                        <option value="">All Recruiters</option>
                        <!-- Populated dynamically -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="source-filter">Source:</label>
                    <select id="source-filter" onchange="filterProspects()">
                        <option value="">All Sources</option>
                        <option value="referral">Referral</option>
                        <option value="social_media">Social Media</option>
                        <option value="job_board">Job Board</option>
                        <option value="career_fair">Career Fair</option>
                        <option value="website">Website</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="search-filter">Search:</label>
                    <input type="text" id="search-filter" placeholder="Name, email, phone..." oninput="filterProspects()">
                </div>
                <div class="filter-group">
                    <label for="date-range-filter">Follow-up Date:</label>
                    <select id="date-range-filter" onchange="filterProspects()">
                        <option value="">All Dates</option>
                        <option value="overdue">Overdue</option>
                        <option value="today">Today</option>
                        <option value="this_week">This Week</option>
                        <option value="this_month">This Month</option>
                        <option value="no_date">No Date Set</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button onclick="loadProspects()" class="btn btn-secondary btn-sm">Refresh</button>
                    <button onclick="toggleAdvancedFilters()" class="btn btn-outline-secondary btn-sm" id="advanced-filter-btn">Advanced</button>
                </div>
            </div>

            <!-- Advanced Filters (Hidden by default) -->
            <div id="advanced-filters" class="advanced-filters" style="display: none;">
                <div class="filters">
                    <div class="filter-group">
                        <label for="created-date-from">Created From:</label>
                        <input type="date" id="created-date-from" onchange="filterProspects()">
                    </div>
                    <div class="filter-group">
                        <label for="created-date-to">Created To:</label>
                        <input type="date" id="created-date-to" onchange="filterProspects()">
                    </div>
                    <div class="filter-group">
                        <label for="follow-up-from">Follow-up From:</label>
                        <input type="date" id="follow-up-from" onchange="filterProspects()">
                    </div>
                    <div class="filter-group">
                        <label for="follow-up-to">Follow-up To:</label>
                        <input type="date" id="follow-up-to" onchange="filterProspects()">
                    </div>
                    <div class="filter-group">
                        <button onclick="clearAllFilters()" class="btn btn-outline-warning btn-sm">Clear All</button>
                    </div>
                </div>
            </div>

            <!-- Bulk Actions Bar -->
            <div id="bulk-actions-bar" class="bulk-actions-bar" style="display: none;">
                <div class="bulk-actions-content">
                    <span id="selected-count">0 selected</span>
                    <div class="bulk-actions-buttons">
                        <select id="bulk-status-change" style="margin-right: 10px;">
                            <option value="">Change Status...</option>
                            <option value="lead">Lead</option>
                            <option value="contacted">Contacted</option>
                            <option value="interview_scheduled">Interview Scheduled</option>
                            <option value="interview_completed">Interview Completed</option>
                            <option value="offer_made">Offer Made</option>
                            <option value="hired">Hired</option>
                            <option value="rejected">Rejected</option>
                            <option value="not_interested">Not Interested</option>
                        </select>
                        <select id="bulk-recruiter-assign" style="margin-right: 10px;">
                            <option value="">Assign Recruiter...</option>
                            <!-- Populated dynamically -->
                        </select>
                        <button onclick="applyBulkStatusChange()" class="btn btn-warning btn-sm">Apply Status</button>
                        <button onclick="applyBulkRecruiterAssign()" class="btn btn-info btn-sm">Assign Recruiter</button>
                        <button onclick="bulkDelete()" class="btn btn-danger btn-sm">Delete Selected</button>
                        <button onclick="clearSelection()" class="btn btn-secondary btn-sm">Clear Selection</button>
                    </div>
                </div>
            </div>
            </div>

            <!-- Prospects Table -->
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll()" title="Select all visible prospects">
                            </th>
                            <th>Name</th>
                            <th>Contact</th>
                            <th>Status</th>
                            <th>Recruiter</th>
                            <th>Next Follow-up</th>
                            <th>Source</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="prospects-table-body">
                        <!-- Prospects will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Prospect Modal -->
    <div id="prospect-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Prospect</h3>
            </div>
            <form id="prospect-form">
                <input type="hidden" id="prospect-id">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="first-name">First Name *</label>
                        <input type="text" id="first-name" required>
                    </div>
                    <div class="form-group">
                        <label for="last-name">Last Name *</label>
                        <input type="text" id="last-name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone">
                    </div>
                    <div class="form-group">
                        <label for="status">Status *</label>
                        <select id="status" required>
                            <option value="lead">Lead</option>
                            <option value="contacted">Contacted</option>
                            <option value="interview_scheduled">Interview Scheduled</option>
                            <option value="interview_completed">Interview Completed</option>
                            <option value="offer_made">Offer Made</option>
                            <option value="hired">Hired</option>
                            <option value="rejected">Rejected</option>
                            <option value="not_interested">Not Interested</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="source">Source</label>
                        <select id="source">
                            <option value="">Select source...</option>
                            <option value="referral">Referral</option>
                            <option value="indeed">Indeed</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="facebook">Facebook</option>
                            <option value="walk_in">Walk-in</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assigned-recruiter">Assigned Recruiter</label>
                        <select id="assigned-recruiter">
                            <option value="">Unassigned</option>
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="next-followup">Next Follow-up</label>
                        <input type="datetime-local" id="next-followup">
                    </div>
                    <div class="form-group">
                        <label for="recurring-followup">Recurring Follow-up</label>
                        <select id="recurring-followup">
                            <option value="">No recurring follow-up</option>
                            <option value="daily">Daily</option>
                            <option value="every-2-days">Every 2 days</option>
                            <option value="every-3-days">Every 3 days</option>
                            <option value="weekly">Weekly</option>
                            <option value="bi-weekly">Bi-weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                        </select>
                        <small style="color: #6c757d; font-size: 0.85em; margin-top: 4px; display: block;">
                            When a follow-up is completed, the next one will be automatically scheduled based on this interval.
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="followup-purpose">Follow-up Purpose</label>
                        <select id="followup-purpose">
                            <option value="">Select purpose (optional)</option>
                            <option value="initial-outreach">Initial outreach</option>
                            <option value="check-application-status">Check application status</option>
                            <option value="interview-preparation">Interview preparation</option>
                            <option value="follow-interview">Follow up after interview</option>
                            <option value="salary-negotiation">Salary negotiation</option>
                            <option value="onboarding-check">Onboarding check</option>
                            <option value="weekly-checkin">Weekly check-in</option>
                            <option value="monthly-update">Monthly update</option>
                            <option value="relationship-building">Relationship building</option>
                            <option value="offer-discussion">Offer discussion</option>
                            <option value="reference-check">Reference check</option>
                            <option value="background-check">Background check status</option>
                            <option value="custom">Custom (see notes)</option>
                        </select>
                        <small style="color: #6c757d; font-size: 0.85em; margin-top: 4px; display: block;">
                            This will show on reminder cards so you know why to follow up. For recurring follow-ups, this purpose carries forward.
                        </small>
                    </div>
                    <div class="form-group full-width">
                        <label for="notes">Notes</label>
                        <textarea id="notes" placeholder="Add any notes about this prospect..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeProspectModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Prospect</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Include Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://tbntifrdpyzdtsofbclq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRibnRpZnJkcHl6ZHRzb2ZiY2xxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxOTYwOTYsImV4cCI6MjA3OTc3MjA5Nn0.GfHb3086SmNfrRYaNLp1JZVtlUf7SWyoCedclvf9D4w';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let allProspects = [];
        let allUsers = [];

        // Check authentication and CRM access
        function checkAuth() {
            const session = localStorage.getItem('gritSession');
            if (!session) {
                window.location.href = 'login.html';
                return null;
            }

            const sessionData = JSON.parse(session);

            // Only Veteran, Manager, and Admin can access CRM
            if (!['Veteran', 'Manager', 'Admin'].includes(sessionData.role)) {
                alert('Access Denied: CRM access requires Veteran, Manager, or Admin privileges');
                window.location.href = 'index.html';
                return null;
            }

            return sessionData;
        }

        // Initialize page
        const currentSession = checkAuth();
        if (currentSession) {
            const displayName = currentSession.firstName && currentSession.lastName ? 
                `${currentSession.firstName} ${currentSession.lastName}` : 
                currentSession.email;
            document.getElementById('current-user-email').textContent = displayName;
            document.getElementById('current-user-role').textContent = currentSession.role;

            // Show navigation based on role
            // Show My Training link for all users
            document.getElementById('nav-my-training').style.display = 'flex';
            
            if (['Veteran', 'Manager', 'Admin'].includes(currentSession.role)) {
                document.getElementById('nav-training').style.display = 'flex';
            }
            
            if (currentSession.role === 'Admin') {
                document.getElementById('nav-admin').style.display = 'flex';
            }

            loadUsers();
            loadProspects();
            loadStats();
            loadReminders();
        }

        // Load users for dropdowns
        async function loadUsers() {
            try {
                const { data: users, error } = await supabase
                    .from('users')
                    .select('id, email, role, first_name, last_name')
                    .order('first_name', 'last_name', 'email');

                if (error) throw error;

                allUsers = users;
                populateUserDropdowns();
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function populateUserDropdowns() {
            const recruiterFilter = document.getElementById('recruiter-filter');
            const assignedRecruiter = document.getElementById('assigned-recruiter');
            
            // Clear existing options (except first one)
            recruiterFilter.innerHTML = '<option value="">All Recruiters</option>';
            assignedRecruiter.innerHTML = '<option value="">Unassigned</option>';
            
            allUsers.forEach(user => {
                const displayName = user.first_name && user.last_name ? 
                    `${user.first_name} ${user.last_name}` : 
                    user.email;
                
                const option1 = document.createElement('option');
                option1.value = user.id;
                option1.textContent = `${displayName} (${user.role})`;
                recruiterFilter.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = user.id;
                option2.textContent = `${displayName} (${user.role})`;
                assignedRecruiter.appendChild(option2);
            });
        }

        // Load prospects from database
        async function loadProspects() {
            try {
                const { data: prospects, error } = await supabase
                    .from('prospects')
                    .select(`
                        *,
                        recruiter:assigned_recruiter_id (
                            id,
                            email,
                            role,
                            first_name,
                            last_name
                        )
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allProspects = prospects;
                displayProspects(prospects);
                loadStats();
            } catch (error) {
                console.error('Error loading prospects:', error);
                showAlert('Failed to load prospects: ' + error.message, 'danger');
            }
        }

        function displayProspects(prospects) {
            const tbody = document.getElementById('prospects-table-body');
            
            if (!prospects || prospects.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No prospects found. <a href="#" onclick="openAddProspectModal()">Add your first prospect</a>.</td></tr>';
                return;
            }

            tbody.innerHTML = prospects.map(prospect => {
                const followUpDate = prospect.next_follow_up_date ? 
                    new Date(prospect.next_follow_up_date).toLocaleDateString() : 
                    'None set';
                
                const recurringIndicator = prospect.recurring_follow_up ? 
                    ` <span style="color: #a10e02; font-weight: bold;" title="Recurring ${prospect.recurring_follow_up}">ðŸ”„</span>` : 
                    '';
                
                const isOverdue = prospect.next_follow_up_date && 
                    new Date(prospect.next_follow_up_date) < new Date() ? 
                    'priority-high' : '';
                
                const recruiterName = prospect.recruiter ? 
                    (prospect.recruiter.first_name && prospect.recruiter.last_name ? 
                        `${prospect.recruiter.first_name} ${prospect.recruiter.last_name}` : 
                        prospect.recruiter.email.split('@')[0]) : 
                    'Unassigned';

                return `
                    <tr class="prospect-row" data-prospect-id="${prospect.id}">
                        <td>
                            <input type="checkbox" class="prospect-checkbox" data-id="${prospect.id}" onchange="updateBulkActions()">
                        </td>
                        <td>
                            <a href="rep-profile.html?id=${prospect.id}" 
                               class="prospect-name-link"
                               title="View ${prospect.first_name}'s training progress">
                                ${prospect.first_name} ${prospect.last_name}
                            </a>
                        </td>
                        <td>
                            ${prospect.email ? `<div>${prospect.email}</div>` : ''}
                            ${prospect.phone ? `<div style="color: #6c757d; font-size: 0.9em;">${prospect.phone}</div>` : ''}
                        </td>
                        <td>
                            <span class="status-badge status-${prospect.status}">
                                ${prospect.status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                            </span>
                        </td>
                        <td>${recruiterName}</td>
                        <td class="${isOverdue}">${followUpDate}${recurringIndicator}</td>
                        <td>${prospect.source ? prospect.source.charAt(0).toUpperCase() + prospect.source.slice(1) : '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="viewProspect(${prospect.id})">View</button>
                            <button class="btn btn-sm btn-secondary" onclick="editProspect(${prospect.id})">Edit</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load stats
        async function loadStats() {
            try {
                const { data: prospects, error } = await supabase
                    .from('prospects')
                    .select('status, next_follow_up_date, created_at');

                if (error) throw error;

                const now = new Date();
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                
                const stats = {
                    total: prospects.length,
                    active: prospects.filter(p => ['lead', 'contacted', 'interview_scheduled'].includes(p.status)).length,
                    interviews: prospects.filter(p => p.status === 'interview_scheduled').length,
                    hired: prospects.filter(p => p.status === 'hired' && new Date(p.created_at) >= startOfMonth).length,
                    overdue: prospects.filter(p => p.next_follow_up_date && new Date(p.next_follow_up_date) < now && !['hired', 'rejected', 'not_interested'].includes(p.status)).length
                };

                document.getElementById('total-prospects').textContent = stats.total;
                document.getElementById('active-leads').textContent = stats.active;
                document.getElementById('interviews-scheduled').textContent = stats.interviews;
                document.getElementById('hired-count').textContent = stats.hired;
                document.getElementById('overdue-followups').textContent = stats.overdue;

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load follow-up reminders
        async function loadReminders() {
            try {
                const { data: prospects, error } = await supabase
                    .from('prospects')
                    .select(`
                        id, first_name, last_name, next_follow_up_date, status, notes, followup_purpose,
                        users!assigned_recruiter_id (first_name, last_name, email)
                    `)
                    .not('next_follow_up_date', 'is', null)
                    .not('status', 'in', '("hired","rejected","not_interested")')
                    .order('next_follow_up_date', { ascending: true });

                if (error) throw error;

                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);

                const reminders = prospects.map(prospect => {
                    const followUpDate = new Date(prospect.next_follow_up_date);
                    const followUpDay = new Date(followUpDate.getFullYear(), followUpDate.getMonth(), followUpDate.getDate());
                    
                    let type = 'upcoming';
                    let priority = 3;
                    
                    if (followUpDay < today) {
                        type = 'overdue';
                        priority = 1;
                    } else if (followUpDay.getTime() === today.getTime()) {
                        type = 'due-today';
                        priority = 2;
                    }

                    return {
                        ...prospect,
                        type,
                        priority,
                        followUpDate
                    };
                }).sort((a, b) => a.priority - b.priority);

                displayReminders(reminders);
            } catch (error) {
                console.error('Error loading reminders:', error);
            }
        }

        // Display reminders
        function displayReminders(reminders) {
            const container = document.getElementById('reminder-alerts');
            const section = document.getElementById('reminders-section');
            
            if (!reminders || reminders.length === 0) {
                container.innerHTML = '<div class="no-reminders">ðŸŽ‰ All caught up! No pending follow-ups.</div>';
                section.style.display = 'block';
                return;
            }

            const priorityReminders = reminders.filter(r => r.type === 'overdue' || r.type === 'due-today');
            
            if (priorityReminders.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            
            container.innerHTML = priorityReminders.map(reminder => {
                const typeText = reminder.type === 'overdue' ? 'Overdue' : 'Due Today';
                const icon = reminder.type === 'overdue' ? 'ðŸš¨' : 'â°';
                const dateStr = reminder.followUpDate.toLocaleDateString();
                const timeStr = reminder.followUpDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

                const notes = reminder.notes ? (reminder.notes.length > 100 ? 
                    reminder.notes.substring(0, 100) + '...' : reminder.notes) : '';
                const notesHtml = notes ? `<div class="reminder-notes">${notes}</div>` : '';
                
                const purposeText = reminder.followup_purpose ? 
                    reminder.followup_purpose.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) : '';
                const purposeHtml = purposeText ? 
                    `<div class="reminder-purpose">ðŸ“‹ ${purposeText}</div>` : '';
                
                return `
                    <div class="reminder-card ${reminder.type}">
                        <div class="reminder-info">
                            <div class="reminder-prospect">
                                ${icon} ${reminder.first_name} ${reminder.last_name}
                            </div>
                            <div class="reminder-details">
                                ${typeText} â€¢ Follow-up scheduled for ${dateStr} at ${timeStr}
                            </div>
                            ${purposeHtml}
                            ${notesHtml}
                        </div>
                        <div class="reminder-actions">
                            <button class="btn-reminder btn-complete" onclick="completeFollowUp(${reminder.id})" title="Complete Follow-up">
                                âœ“<span class="btn-text"> Complete</span>
                            </button>
                            <button class="btn-reminder btn-snooze" onclick="snoozeReminder(${reminder.id})" title="Snooze Reminder">
                                â°<span class="btn-text"> Snooze</span>
                            </button>
                            <button class="btn-reminder btn-edit-reminder" onclick="editProspect(${reminder.id})" title="Edit Prospect">
                                âœï¸<span class="btn-text"> Edit</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Calculate next recurring follow-up date
        function calculateNextFollowUpDate(currentDate, recurringType) {
            if (!recurringType || !currentDate) return null;
            
            const date = new Date(currentDate);
            
            switch(recurringType) {
                case 'daily':
                    date.setDate(date.getDate() + 1);
                    break;
                case 'every-2-days':
                    date.setDate(date.getDate() + 2);
                    break;
                case 'every-3-days':
                    date.setDate(date.getDate() + 3);
                    break;
                case 'weekly':
                    date.setDate(date.getDate() + 7);
                    break;
                case 'bi-weekly':
                    date.setDate(date.getDate() + 14);
                    break;
                case 'monthly':
                    date.setMonth(date.getMonth() + 1);
                    break;
                case 'quarterly':
                    date.setMonth(date.getMonth() + 3);
                    break;
                default:
                    return null;
            }
            
            return date.toISOString();
        }

        // Complete follow-up
        async function completeFollowUp(prospectId) {
            try {
                // First, get the prospect to check for recurring follow-up
                const { data: prospect, error: fetchError } = await supabase
                    .from('prospects')
                    .select('next_follow_up_date, recurring_follow_up, followup_purpose')
                    .eq('id', prospectId)
                    .single();
                
                if (fetchError) throw fetchError;
                
                // Calculate next follow-up date if recurring is set
                let nextFollowUpDate = null;
                if (prospect.recurring_follow_up && prospect.next_follow_up_date) {
                    nextFollowUpDate = calculateNextFollowUpDate(prospect.next_follow_up_date, prospect.recurring_follow_up);
                }
                
                // Update the prospect
                const { error } = await supabase
                    .from('prospects')
                    .update({ 
                        next_follow_up_date: nextFollowUpDate, 
                        updated_at: new Date().toISOString() 
                    })
                    .eq('id', prospectId);

                if (error) throw error;
                
                if (nextFollowUpDate) {
                    showAlert('Follow-up completed! Next follow-up scheduled.', 'success');
                } else {
                    showAlert('Follow-up marked as complete!', 'success');
                }
                loadReminders();
                loadProspects();
                loadStats();
            } catch (error) {
                console.error('Error completing follow-up:', error);
                showAlert('Error completing follow-up. Please try again.', 'error');
            }
        }

        // Snooze reminder
        async function snoozeReminder(prospectId) {
            const days = prompt('Snooze for how many days?', '1');
            if (!days || isNaN(days)) return;
            
            try {
                const newDate = new Date();
                newDate.setDate(newDate.getDate() + parseInt(days));
                
                const { error } = await supabase
                    .from('prospects')
                    .update({ 
                        next_follow_up_date: newDate.toISOString(),
                        updated_at: new Date().toISOString() 
                    })
                    .eq('id', prospectId);

                if (error) throw error;
                
                showAlert(`Follow-up snoozed for ${days} day(s)!`, 'success');
                loadReminders();
                loadProspects();
                loadStats();
            } catch (error) {
                console.error('Error snoozing reminder:', error);
                showAlert('Error snoozing reminder. Please try again.', 'error');
            }
        }

        // Filter prospects
        function filterProspects() {
            const statusFilter = document.getElementById('status-filter').value;
            const recruiterFilter = document.getElementById('recruiter-filter').value;
            const searchFilter = document.getElementById('search-filter').value.toLowerCase();

            let filteredProspects = allProspects.filter(prospect => {
                const matchesStatus = !statusFilter || prospect.status === statusFilter;
                const matchesRecruiter = !recruiterFilter || prospect.assigned_recruiter_id == recruiterFilter;
                const matchesSearch = !searchFilter || 
                    prospect.first_name.toLowerCase().includes(searchFilter) ||
                    prospect.last_name.toLowerCase().includes(searchFilter) ||
                    (prospect.email && prospect.email.toLowerCase().includes(searchFilter)) ||
                    (prospect.phone && prospect.phone.includes(searchFilter));

                return matchesStatus && matchesRecruiter && matchesSearch;
            });

            displayProspects(filteredProspects);
        }

        // Modal functions
        function openAddProspectModal() {
            document.getElementById('modal-title').textContent = 'Add New Prospect';
            document.getElementById('prospect-form').reset();
            document.getElementById('prospect-id').value = '';
            document.getElementById('prospect-modal').classList.add('show');
        }

        function editProspect(prospectId) {
            const prospect = allProspects.find(p => p.id === prospectId);
            if (!prospect) return;

            document.getElementById('modal-title').textContent = 'Edit Prospect';
            document.getElementById('prospect-id').value = prospect.id;
            document.getElementById('first-name').value = prospect.first_name;
            document.getElementById('last-name').value = prospect.last_name;
            document.getElementById('email').value = prospect.email || '';
            document.getElementById('phone').value = prospect.phone || '';
            document.getElementById('status').value = prospect.status;
            document.getElementById('source').value = prospect.source || '';
            document.getElementById('assigned-recruiter').value = prospect.assigned_recruiter_id || '';
            document.getElementById('notes').value = prospect.notes || '';
            
            if (prospect.next_follow_up_date) {
                const date = new Date(prospect.next_follow_up_date);
                document.getElementById('next-followup').value = date.toISOString().slice(0, 16);
            }
            document.getElementById('recurring-followup').value = prospect.recurring_follow_up || '';
            document.getElementById('followup-purpose').value = prospect.followup_purpose || '';

            document.getElementById('prospect-modal').classList.add('show');
        }

        function viewProspect(prospectId) {
            // For now, just edit - later we can create a dedicated view page
            window.location.href = `rep-profile.html?id=${prospectId}`;
        }

        function closeProspectModal() {
            document.getElementById('prospect-modal').classList.remove('show');
        }

        // Save prospect
        document.getElementById('prospect-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const prospectId = document.getElementById('prospect-id').value;
            const prospectData = {
                first_name: document.getElementById('first-name').value.trim(),
                last_name: document.getElementById('last-name').value.trim(),
                email: document.getElementById('email').value.trim() || null,
                phone: document.getElementById('phone').value.trim() || null,
                status: document.getElementById('status').value,
                source: document.getElementById('source').value || null,
                assigned_recruiter_id: document.getElementById('assigned-recruiter').value || null,
                next_follow_up_date: document.getElementById('next-followup').value || null,
                recurring_follow_up: document.getElementById('recurring-followup').value || null,
                followup_purpose: document.getElementById('followup-purpose').value || null,
                notes: document.getElementById('notes').value.trim() || null,
                updated_at: new Date().toISOString()
            };

            try {
                let result;
                if (prospectId) {
                    // Update existing prospect
                    result = await supabase
                        .from('prospects')
                        .update(prospectData)
                        .eq('id', prospectId);
                } else {
                    // Create new prospect
                    result = await supabase
                        .from('prospects')
                        .insert([prospectData]);
                }

                if (result.error) throw result.error;

                showAlert(prospectId ? 'Prospect updated successfully' : 'Prospect added successfully', 'success');
                closeProspectModal();
                loadProspects();

            } catch (error) {
                console.error('Error saving prospect:', error);
                showAlert('Failed to save prospect: ' + error.message, 'danger');
            }
        });

        // Show alert message
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alert-message');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type} show`;

            setTimeout(() => {
                alertDiv.classList.remove('show');
            }, 4000);
        }

        // Logout function
        function logout() {
            localStorage.removeItem('gritSession');
            window.location.href = 'login.html';
        }

        // Toggle Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            const mobileHamburger = document.getElementById('mobile-hamburger-icon');
            const hamburgerButton = document.querySelector('.mobile-hamburger');

            sidebar.classList.toggle('expanded');
            
            // Toggle mobile hamburger animation
            if (mobileHamburger) {
                if (sidebar.classList.contains('expanded')) {
                    mobileHamburger.style.transform = 'rotate(90deg)';
                } else {
                    mobileHamburger.style.transform = 'rotate(0deg)';
                }
            }

            // Toggle overlay for mobile
            if (window.innerWidth <= 768) {
                overlay.classList.toggle('active');
            }
        }

        // Close modal when clicking outside
        document.getElementById('prospect-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeProspectModal();
            }
        });

        // Advanced Filters and Bulk Actions Functions

        // Toggle advanced filters visibility
        function toggleAdvancedFilters() {
            const advancedFilters = document.getElementById('advanced-filters');
            const button = document.getElementById('advanced-filter-btn');
            
            if (advancedFilters.style.display === 'none') {
                advancedFilters.style.display = 'block';
                button.textContent = 'Hide Advanced';
            } else {
                advancedFilters.style.display = 'none';
                button.textContent = 'Advanced';
            }
        }

        // Clear all filters
        function clearAllFilters() {
            document.getElementById('status-filter').value = '';
            document.getElementById('recruiter-filter').value = '';
            document.getElementById('source-filter').value = '';
            document.getElementById('search-filter').value = '';
            document.getElementById('date-range-filter').value = '';
            document.getElementById('created-date-from').value = '';
            document.getElementById('created-date-to').value = '';
            document.getElementById('follow-up-from').value = '';
            document.getElementById('follow-up-to').value = '';
            filterProspects();
        }

        // Enhanced filter prospects function
        function filterProspects() {
            const statusFilter = document.getElementById('status-filter').value;
            const recruiterFilter = document.getElementById('recruiter-filter').value;
            const sourceFilter = document.getElementById('source-filter').value;
            const searchFilter = document.getElementById('search-filter').value.toLowerCase();
            const dateRangeFilter = document.getElementById('date-range-filter').value;
            const createdFromFilter = document.getElementById('created-date-from').value;
            const createdToFilter = document.getElementById('created-date-to').value;
            const followUpFromFilter = document.getElementById('follow-up-from').value;
            const followUpToFilter = document.getElementById('follow-up-to').value;

            const filtered = allProspects.filter(prospect => {
                // Status filter
                if (statusFilter && prospect.status !== statusFilter) return false;
                
                // Recruiter filter
                if (recruiterFilter && prospect.assigned_recruiter_id !== parseInt(recruiterFilter)) return false;
                
                // Source filter
                if (sourceFilter && prospect.source !== sourceFilter) return false;
                
                // Search filter (name, email, phone)
                if (searchFilter) {
                    const searchText = `${prospect.first_name} ${prospect.last_name} ${prospect.email || ''} ${prospect.phone || ''}`.toLowerCase();
                    if (!searchText.includes(searchFilter)) return false;
                }
                
                // Date range filter for follow-up dates
                if (dateRangeFilter) {
                    const today = new Date();
                    const followUpDate = prospect.next_follow_up_date ? new Date(prospect.next_follow_up_date) : null;
                    
                    switch (dateRangeFilter) {
                        case 'overdue':
                            if (!followUpDate || followUpDate >= today) return false;
                            break;
                        case 'today':
                            if (!followUpDate || followUpDate.toDateString() !== today.toDateString()) return false;
                            break;
                        case 'this_week':
                            if (!followUpDate) return false;
                            const weekFromToday = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                            if (followUpDate < today || followUpDate > weekFromToday) return false;
                            break;
                        case 'this_month':
                            if (!followUpDate) return false;
                            if (followUpDate.getMonth() !== today.getMonth() || followUpDate.getFullYear() !== today.getFullYear()) return false;
                            break;
                        case 'no_date':
                            if (followUpDate) return false;
                            break;
                    }
                }
                
                // Created date range filters
                if (createdFromFilter || createdToFilter) {
                    const createdDate = new Date(prospect.created_at);
                    if (createdFromFilter && createdDate < new Date(createdFromFilter)) return false;
                    if (createdToFilter && createdDate > new Date(createdToFilter + 'T23:59:59')) return false;
                }
                
                // Follow-up date range filters
                if (followUpFromFilter || followUpToFilter) {
                    const followUpDate = prospect.next_follow_up_date ? new Date(prospect.next_follow_up_date) : null;
                    if (followUpFromFilter && (!followUpDate || followUpDate < new Date(followUpFromFilter))) return false;
                    if (followUpToFilter && (!followUpDate || followUpDate > new Date(followUpToFilter + 'T23:59:59'))) return false;
                }
                
                return true;
            });

            displayProspects(filtered);
        }

        // Bulk actions functions
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all-checkbox');
            const checkboxes = document.querySelectorAll('.prospect-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                const row = checkbox.closest('tr');
                if (checkbox.checked) {
                    row.classList.add('selected');
                } else {
                    row.classList.remove('selected');
                }
            });
            
            updateBulkActions();
        }

        function updateBulkActions() {
            const checkboxes = document.querySelectorAll('.prospect-checkbox:checked');
            const count = checkboxes.length;
            const bulkActionsBar = document.getElementById('bulk-actions-bar');
            const selectedCount = document.getElementById('selected-count');
            
            if (count > 0) {
                bulkActionsBar.style.display = 'block';
                selectedCount.textContent = `${count} selected`;
            } else {
                bulkActionsBar.style.display = 'none';
            }
            
            // Update select all checkbox state
            const allCheckboxes = document.querySelectorAll('.prospect-checkbox');
            const selectAllCheckbox = document.getElementById('select-all-checkbox');
            if (count === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (count === allCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
            
            // Update row highlighting
            checkboxes.forEach(checkbox => {
                checkbox.closest('tr').classList.add('selected');
            });
            
            document.querySelectorAll('.prospect-checkbox:not(:checked)').forEach(checkbox => {
                checkbox.closest('tr').classList.remove('selected');
            });
        }

        function clearSelection() {
            document.querySelectorAll('.prospect-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('select-all-checkbox').checked = false;
            updateBulkActions();
        }

        async function applyBulkStatusChange() {
            const status = document.getElementById('bulk-status-change').value;
            const checkboxes = document.querySelectorAll('.prospect-checkbox:checked');
            
            if (!status) {
                showAlert('Please select a status to apply.', 'warning');
                return;
            }
            
            if (checkboxes.length === 0) {
                showAlert('Please select prospects to update.', 'warning');
                return;
            }
            
            if (!confirm(`Update ${checkboxes.length} prospect(s) to status: ${status.replace('_', ' ')}?`)) {
                return;
            }
            
            try {
                const prospectIds = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
                
                const { error } = await supabase
                    .from('prospects')
                    .update({ status: status })
                    .in('id', prospectIds);
                
                if (error) throw error;
                
                showAlert(`Successfully updated ${prospectIds.length} prospect(s).`, 'success');
                clearSelection();
                loadProspects();
                
            } catch (error) {
                console.error('Error updating prospects:', error);
                showAlert('Failed to update prospects: ' + error.message, 'danger');
            }
        }

        async function applyBulkRecruiterAssign() {
            const recruiterId = document.getElementById('bulk-recruiter-assign').value;
            const checkboxes = document.querySelectorAll('.prospect-checkbox:checked');
            
            if (!recruiterId) {
                showAlert('Please select a recruiter to assign.', 'warning');
                return;
            }
            
            if (checkboxes.length === 0) {
                showAlert('Please select prospects to assign.', 'warning');
                return;
            }
            
            if (!confirm(`Assign ${checkboxes.length} prospect(s) to the selected recruiter?`)) {
                return;
            }
            
            try {
                const prospectIds = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
                
                const { error } = await supabase
                    .from('prospects')
                    .update({ assigned_recruiter_id: parseInt(recruiterId) })
                    .in('id', prospectIds);
                
                if (error) throw error;
                
                showAlert(`Successfully assigned ${prospectIds.length} prospect(s).`, 'success');
                clearSelection();
                loadProspects();
                
            } catch (error) {
                console.error('Error assigning recruiter:', error);
                showAlert('Failed to assign recruiter: ' + error.message, 'danger');
            }
        }

        async function bulkDelete() {
            const checkboxes = document.querySelectorAll('.prospect-checkbox:checked');
            
            if (checkboxes.length === 0) {
                showAlert('Please select prospects to delete.', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete ${checkboxes.length} prospect(s)? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const prospectIds = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
                
                const { error } = await supabase
                    .from('prospects')
                    .delete()
                    .in('id', prospectIds);
                
                if (error) throw error;
                
                showAlert(`Successfully deleted ${prospectIds.length} prospect(s).`, 'success');
                clearSelection();
                loadProspects();
                
            } catch (error) {
                console.error('Error deleting prospects:', error);
                showAlert('Failed to delete prospects: ' + error.message, 'danger');
            }
        }

        // Export prospects to CSV
        function exportProspects() {
            if (!allProspects || allProspects.length === 0) {
                showAlert('No prospects to export.', 'warning');
                return;
            }
            
            const dataToExport = allProspects.map(prospect => ({
                first_name: prospect.first_name,
                last_name: prospect.last_name,
                email: prospect.email,
                phone: prospect.phone,
                status: prospect.status,
                source: prospect.source,
                recruiter_email: prospect.recruiter ? prospect.recruiter.email : '',
                notes: prospect.notes || '',
                next_follow_up_date: prospect.next_follow_up_date || '',
                created_at: prospect.created_at
            }));
            
            const headers = Object.keys(dataToExport[0]).join(',');
            const rows = dataToExport.map(row => 
                Object.values(row).map(value => 
                    typeof value === 'string' && value.includes(',') ? `"${value}"` : value
                ).join(',')
            ).join('\\n');
            const content = headers + '\\n' + rows;
            
            const blob = new Blob([content], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prospects.csv';
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert(`Exported ${dataToExport.length} prospects to CSV.`, 'success');
        }

        function showImportTemplate() {
            const content = 'first_name,last_name,email,phone,status,recruiter_email,source,notes\\nJohn,Smith,john@email.com,555-0123,lead,manager@company.com,referral,Sample prospect';
            
            const blob = new Blob([content], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prospects_template.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        async function importProspects(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('file-name').textContent = file.name;
            
            const text = await file.text();
            const lines = text.split('\\n').filter(line => line.trim());
            
            if (lines.length < 2) {
                showAlert('CSV file must have a header row and at least one data row.', 'danger');
                return;
            }
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const prospects = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const prospect = {};
                
                headers.forEach((header, index) => {
                    prospect[header] = values[index] || null;
                });
                
                // Validate required fields
                if (!prospect.first_name || !prospect.last_name) {
                    showAlert(`Row ${i + 1}: First name and last name are required.`, 'warning');
                    continue;
                }
                
                prospects.push({
                    first_name: prospect.first_name,
                    last_name: prospect.last_name,
                    email: prospect.email || null,
                    phone: prospect.phone || null,
                    status: prospect.status || 'lead',
                    source: prospect.source || 'other',
                    notes: prospect.notes || null,
                    next_follow_up_date: prospect.next_follow_up_date || null
                });
            }
            
            if (prospects.length === 0) {
                showAlert('No valid prospects found in CSV file.', 'warning');
                return;
            }
            
            if (!confirm(`Import ${prospects.length} prospects from CSV file?`)) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('prospects')
                    .insert(prospects);
                
                if (error) throw error;
                
                showAlert(`Successfully imported ${prospects.length} prospects.`, 'success');
                loadProspects();
                event.target.value = ''; // Clear file input
                document.getElementById('file-name').textContent = '';
                
            } catch (error) {
                console.error('Error importing prospects:', error);
                showAlert('Failed to import prospects: ' + error.message, 'danger');
            }
        }

        // Populate bulk recruiter dropdown
        function populateBulkRecruiterDropdown() {
            const bulkRecruiterSelect = document.getElementById('bulk-recruiter-assign');
            const recruiterFilter = document.getElementById('recruiter-filter');
            
            // Copy options from the main recruiter filter
            bulkRecruiterSelect.innerHTML = '<option value="">Assign Recruiter...</option>';
            
            for (let i = 1; i < recruiterFilter.options.length; i++) {
                const option = recruiterFilter.options[i].cloneNode(true);
                bulkRecruiterSelect.appendChild(option);
            }
        }

        // Call this after loading recruiters
        const originalLoadProspects = loadProspects;
        loadProspects = async function() {
            await originalLoadProspects();
            populateBulkRecruiterDropdown();
        };

    </script>
</body>
</html>